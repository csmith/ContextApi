#LyX 1.6.5 created this file. For more info see http://www.lyx.org/
\lyxformat 345
\begin_document
\begin_header
\textclass article
\use_default_options true
\language english
\inputencoding auto
\font_roman default
\font_sans default
\font_typewriter default
\font_default_family default
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100

\graphics default
\paperfontsize default
\spacing single
\use_hyperref false
\papersize a4paper
\use_geometry false
\use_amsmath 1
\use_esint 1
\cite_engine basic
\use_bibtopic false
\paperorientation portrait
\secnumdepth 3
\tocdepth 3
\paragraph_separation skip
\defskip medskip
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\author "" 
\author "" 
\end_header

\begin_body

\begin_layout Title
Context-Aware API for Android Devices
\end_layout

\begin_layout Author
Chris Smith
\begin_inset Newline newline
\end_inset

Supervisor: Naranker Dulay
\end_layout

\begin_layout Date
Summer 2010
\end_layout

\begin_layout Standard
All materials can be accessed electronically at:
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
/homes/cs106/....
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Abstract
In recent years location-based services have seen a dramatic increase in
 adoption, and all modern smartphone platforms have integrated services
 to facilitate the creation location-aware applications.
 Such applications enhance the experience of users, using location to modify
 content or alter the behaviour of the application to better suit the circumstan
ces.
\end_layout

\begin_layout Abstract
The product of this project is a 
\emph on
context
\emph default
-aware API for the Android platform.
 This allows applications to augment the already available location data
 with extra 
\emph on
context
\emph default
 about the user's situation - primarily their current activity.
 It also develops an algorithm for recognising 
\emph on
places
\emph default
 which are relevant to the user, and monitoring which activities are performed
 in 
\emph on
journeys
\emph default
 between those places, thus enabling predictions of the user's likely destinatio
n based on their activity.
\end_layout

\begin_layout Abstract
Research into other methods of annotating context was conducted, and it
 was found that most potential sources of context information either produced
 little or no information, or were too battery-draining to perform in a
 real world environment with current technology.
 Much effort was placed into optimising the API to have as small effect
 on battery life as possible.
\end_layout

\begin_layout Abstract
A context-aware API was successfully produced, along with a collection of
 applications which use the API in order to demonstrate its features or
 provide example use cases.
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout LyX-Code
\begin_inset CommandInset toc
LatexCommand tableofcontents

\end_inset


\end_layout

\begin_layout LyX-Code
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Part
Introduction
\end_layout

\begin_layout Section
Proposal
\end_layout

\begin_layout Quote
Objective: to create an API for android applications to query the user's
 [probable] current activity, and to consider and implement possible uses
 for this API in existing applications.
 The user's activity would be determined based on available sensor and ambient
 data (e.g.
 time, location, orientation/movement of device, background noises, camera
 image, in-range bluetooth devices, etc), previous behaviour of the user,
 and possibly behaviour of other users which has been shared between devices.
\end_layout

\begin_layout Quote
Motivation: Activity-awareness would be a major step forward in making mobile
 devices better able to adapt to what the user wants to do with them.
 The latest generation of mobile phones have made location-aware applications
 quite ubiquitous, and a lot of these could be further enhanced by making
 them activity aware.
 For example, an application which lists businesses in a certain area could
 not only know the search area (by merit of being location-aware), but could
 also make an educated guess at what you're looking for (e.g.
 the activity API may suggest the user is likely to be going to lunch, so
 the application could initially show nearby eating establishments instead
 of requiring the user to search for them).
\end_layout

\begin_layout Quote
Challenges/issues: primary challenge is developing an algorithm which can
 make reasonable estimates as to the user's activity (or attempting and
 then justifying why such an algorithm is not feasible, and investigating
 requirements or alternatives), and would form the bulk of the project.
 Sub-challenges within this include: researching/implementing machine learning
 techniques so the algorithm can take previous behaviour into account, processin
g data from 'messy' inputs such as mic/camera, and designing an API that
 would enable third-party app developers to easily make their applications
 activity aware.
\end_layout

\begin_layout Quote
Approach: data from sensors would need to be processed (e.g.
 mic input processed into a figure for ambient noise level in dB).
 The combination of this processed data would then need to be fed into an
 algorithm (possibly a neural network) to determine likelihood of various
 activities.
 There would need to be some mechanism for users to correct or train the
 system (at least initially), and it's possible that this data could then
 be shared to other users of the api/application.
\end_layout

\begin_layout Section
Aims and Motivation
\end_layout

\begin_layout Standard
The primary aim of this project is to create an application for the Android
 platform that can sense the user's context in some fashion.
 This application will have a public interface which will allow other applicatio
ns written by third party developers to read and receive updates about the
 user's context.
\end_layout

\begin_layout Standard
The ease of access to location aware services in modern smartphone platforms
 has lead to a surge in the number of applications which improve their utility
 or behaviour by integrating location information.
 It stands to reason that if additional context information were available,
 developers would be able to take advantage of this and further improve
 the utility of their applications.
 This, in turn, would increase the productivity of the end-user.
\end_layout

\begin_layout Standard
As discussed in
\begin_inset CommandInset ref
LatexCommand ref
reference "par:Background"

\end_inset

, a large amount of existing research has been done on context-aware devices,
 and specifically on activity-aware systems.
 There have also been some limited implementations for smartphones.
 Unfortunately, the end product of most of this research is not suitable
 for deployment or use in practical, every-day circumstances.
 This project aims to produce a working prototype which can be used on a
 day-to-day basis on an Android smartphone without significantly degrading
 performance.
\end_layout

\begin_layout Section
Issues and challenges
\end_layout

\begin_layout Standard
One of the main challenges for this project will be accomplashing accurate
 and useful context-awareness without significantly hindering the battery
 life or performance of a typical device.
 Existing algorithms tend to be extremely verbose, sometimes performing
 upwards of thousands of calculations per classification; on a mobile device
 this is likely to severely cripple battery life.
\end_layout

\begin_layout Standard
The problem of battery life affects all areas of the project - from how
 often data is collected, how the data is then analysed, and which sources
 of potential data are consulted.
 A large amount of time will need to be spent analysing the various potential
 data sources and establishing whether or not the cost in consulting them
 is worth the reduction in battery lifetime and any gain in the reliability
 or accuracy of context information.
\end_layout

\begin_layout Standard
The aim of the application is to provide the context data to third-party
 applications, so another challenge will be designing an appropriate interface
 which will allow applications to query and receive updates about the user's
 context.
 Consideration will have to be given as to any security measures (such as
 access control) which may need to be applied in order to protect user privacy.
\begin_inset Note Note
status open

\begin_layout Plain Layout
Contributions
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Part
Background
\begin_inset CommandInset label
LatexCommand label
name "par:Background"

\end_inset


\end_layout

\begin_layout Standard
Context- or Activity-Aware devices is an area currently under lots of research.
 There are many and varied applications of activity-aware devices, ranging
 from personal fitness and healthcare to training factory workers or merely
 playing music.
\end_layout

\begin_layout Standard
While this research is going on, there has been a huge expansion in the
 ownership, use and power of mobile telephones.
 Mobile telephones are so ubiquitous and now come with such a large sensor
 platform that they are the obvious choice for implementing activity-aware
 technologies for use in day-to-day life.
\end_layout

\begin_layout Standard
This project aims to make a context-aware API available on an open mobile
 platform, which will enable developers to start adding context-aware functional
ity to their applications without the extremely large overhead of writing
 a logger and classifier themselves, or re-engineering the application to
 use an existing context-aware framework if one is available.
\end_layout

\begin_layout Section
Applications
\end_layout

\begin_layout Standard
There are many documented applications of activity-aware systems, and current
 research efforts which bring the technology to mobile telephones will only
 serve to lengthen this list.
\end_layout

\begin_layout Standard
The canonical example for activity-awareness, especially on mobile telephones,
 is modeling the user's 
\begin_inset Quotes eld
\end_inset

interruptibility
\begin_inset Quotes erd
\end_inset


\begin_inset CommandInset citation
LatexCommand cite
key "Siewiorek2003,Raento2005"

\end_inset

.
 This allows the software to know whether it's appropriate (or "polite")
 to disturb the user, and can advise the user's contacts when they are busy.
 It can also be used to create a 
\begin_inset Quotes eld
\end_inset

smart answering machine
\begin_inset Quotes erd
\end_inset

 
\begin_inset CommandInset citation
LatexCommand cite
key "Hudson2003"

\end_inset

 which can selectively direct calls straight to an answering machine if
 the user is engaged in an "uninterpretable" activity and the call does
 not appear to be important.
 These allow the user's mobile telephone to better approximate human behaviour
 - when approaching someone in person it is normally quite easy to determine
 whether it would be polite or necessary to disturb them, based on their
 demeanour, activity, and the urgency of your request; when picking up the
 telephone it is not possible at all without assistance from an activity-aware
 system.
\end_layout

\begin_layout Standard
The current implementations of these ideas have several problems, however.
 The more interesting research 
\begin_inset CommandInset citation
LatexCommand cite
key "Hudson2003"

\end_inset

 requires a static camera fixed in an office to observe user behaviour,
 instead of implementing it directly on a telephone, which obviously constrains
 its usefulness.
 Of the two solutions actually targeted at mobile telephones, one
\begin_inset CommandInset citation
LatexCommand cite
key "Siewiorek2003"

\end_inset

 requires bulky custom hardware which the user must carry on their belt,
 and the other 
\begin_inset CommandInset citation
LatexCommand cite
key "Raento2005"

\end_inset

does not expose an API to other applications and only surfaces the context-aware
 functionality in two small applications whose focus is on social interaction
 rather than improving the user's experience of the telephone locally.
 This project will aim to bring the ideas of these to generic hardware (an
 Android mobile telephone), and to provide an API which other applications
 can harness.
\end_layout

\begin_layout Standard
One use particularly suitable for mobile phones is dynamic adaptation of
 the device's settings based on the user's current activity and context
\begin_inset CommandInset citation
LatexCommand cite
key "Schmidt1999"

\end_inset

.
 When a user is walking the device can dynamically increase the font size
 to make it easier to read with an unsteady hand, and correspondingly decrease
 it when the user is stationary.
 In a similar fashion, the brightness of the backlight can be altered based
 on the ambient light level, and the ringer volume altered according to
 the noise level.
 Unfortunately this research did not progress beyond a feasibility study
 and was implemented on a Nokia 6110, which is severely outdated by today's
 standards.
 
\end_layout

\begin_layout Standard
Another popular area for activity-aware systems is in healthcare.
 Such systems can be used to monitor vulnerable people as they go about
 day to day activities to ensure that they're not in trouble - several systems
\begin_inset CommandInset citation
LatexCommand cite
key "Song2005,Maurer2006"

\end_inset

 can be used to monitor elderly persons and summon help if it is detected
 that they have fallen.
 Another healthcare application
\begin_inset CommandInset citation
LatexCommand cite
key "Tentori2008"

\end_inset

 allows nurses to remotely monitor the activities of their patients in a
 hospital ward, allowing them to respond to problems and keep up-to-date
 with their patients' well-being while not physically present.
 Activity-aware applications have also been used to try to encourage users
 to be more healthy; one novel application records the day-to-day fitness
 activities a user performs and uses this as a basis for a virtual 
\begin_inset Quotes eld
\end_inset

garden
\begin_inset Quotes erd
\end_inset

 that blossoms or wilts according to how much the user works out in a week
\begin_inset CommandInset citation
LatexCommand cite
key "Consolvo2008"

\end_inset

.
\end_layout

\begin_layout Standard
As well as monitoring activities which the user is familiar with, activity-aware
 systems can also be used to assist users in learning new activities.
 One application
\begin_inset CommandInset citation
LatexCommand cite
key "Stiefmeier2008"

\end_inset

 monitors the activities of trainee workers in a car manufacturing plant,
 and helps to provide a link between theoretical classroom-based training
 and practical work.
 The activity-aware system can offer advice to the workers that's directly
 related to the current task they're performing, and can even monitor their
 activities for compliance with procedures and give them a score afterwards.
\end_layout

\begin_layout Standard
While the research into healthcare and training applications present novel
 uses of activity-aware systems, the applications themselves are not really
 applicable to a mobile device or the scope of this project.
 The research does, however, describe the techniques used in those applications
 for activity classification and should prove useful in that respect.
\end_layout

\begin_layout Standard
Other areas of research include making activity-aware suggestions to the
 user 
\begin_inset CommandInset citation
LatexCommand cite
key "Bellotti2008"

\end_inset

, or issuing reminders or alerts based on the user's activity 
\begin_inset CommandInset citation
LatexCommand cite
key "Schilit1994"

\end_inset

.
 One example of the latter is an activity-aware system that detects when
 the user is making coffee, and plays a sound on a remote computer to alert
 thirsty coworkers to the fact.
 Sound isn't only limited to alerts, however: the 
\noun on
XPOD
\noun default

\begin_inset CommandInset citation
LatexCommand cite
key "Dornbush2005"

\end_inset

 project is an activity-aware music player, which tailors the music being
 played to the user's current activity based on their past ratings.
 This type of activity-aware device presents a much greater level of personalisa
tion than previously possible, and making this type of customisation available
 to mobile telephone users and application developers will surely result
 in many new applications.
\end_layout

\begin_layout Section
Inferring activity
\end_layout

\begin_layout Standard
There are three general phases in most context-aware systems: a sensing
 component, which reads or receives raw sensor data relating to the user's
 environment or activity; a feature extraction component, which analysis
 the sensor data and identifies a set of features from that data; and a
 classification component, which uses the extracted features to reason about
 the user's activity
\begin_inset CommandInset citation
LatexCommand cite
key "Choudhury2008"

\end_inset

.
 Each of these components will be expanded on below.
 Depending on the method of classification, some initial or continuous training
 may be required, and this is also considered below.
\end_layout

\begin_layout Subsection
Sensors and devices
\end_layout

\begin_layout Standard
At the basis of activity-recognition are the physical hardware sensors.
 The most commonly used sensor is the accelerometer, which outputs the accelerat
ion of the sensor
\begin_inset Foot
status collapsed

\begin_layout Plain Layout
and thus the device to which it's attached, and therefore the person using
 the device
\end_layout

\end_inset

 along a certain axis.
 There is extensive research on using accelerometers to classify activities
 such as walking 
\begin_inset CommandInset citation
LatexCommand cite
key "Mathie2004,Garakani2009"

\end_inset

 (including whether or not the subject is walking on flat ground or up and
 down stairs 
\begin_inset CommandInset citation
LatexCommand cite
key "Caros2005"

\end_inset

), running 
\begin_inset CommandInset citation
LatexCommand cite
key "Garakani2009"

\end_inset

, falling 
\begin_inset CommandInset citation
LatexCommand cite
key "Mathie2004"

\end_inset

, sitting 
\begin_inset CommandInset citation
LatexCommand cite
key "Mathie2004,Garakani2009"

\end_inset

, cycling 
\begin_inset CommandInset citation
LatexCommand cite
key "Garakani2009"

\end_inset

, etc.
\end_layout

\begin_layout Standard
Smartphones also come equipped with a microphone and GSM stack (prerequisites
 for a telephone conversation!), and commonly a camera, geolocation API
 (usually backed by GPS) and Bluetooth stack.
 With the exception of the latter two, these types of sensors are not particular
ly well explored for their use in context-aware systems at present.
 It is easy to reason how each would be useful - a microphone can reveal
 the ambient noise, which could indicate the difference between sitting
 in a library and a bar; the camera likewise can reveal the lighting conditions
 (if the device is not in a pocket or bag).
 The GSM stack can provide rough location information and also a signal
 strength to one or more cell towers; the signal strength will vary both
 with the user's proximity to the cell tower and the environment around
 them - being inside will degrade the signal more than being in open air,
 for example - so may provide vital clues to a context-aware system.
 One aspect of this project will be to research how the microphone, camera
 and GSM stack can be used to enhance existing activity classification algorithm
s.
\end_layout

\begin_layout Standard
Current research on location information and Bluetooth device proximity
 is summarised in section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Location-analysis"

\end_inset

 (p
\begin_inset CommandInset ref
LatexCommand pageref
reference "sec:Location-analysis"

\end_inset

) and 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Bluetooth"

\end_inset

 (p
\begin_inset CommandInset ref
LatexCommand pageref
reference "sec:Bluetooth"

\end_inset

) respectively.
\end_layout

\begin_layout Subsection
Feature detection
\end_layout

\begin_layout Standard
It is not possible to reason directly about raw sensor inputs, so the next
 step in inferring activities is to extract useful 
\emph on
features
\emph default
 from the raw input.
 Features are usually mathematical properties of the input data, such as
 the difference between the minimum and maximum data point in a given time
 frame.
 Most classifiers use an extremely large number of features - 
\begin_inset CommandInset citation
LatexCommand citet
key "Hein2008"

\end_inset

 detect 562 different features from their inputs.
\end_layout

\begin_layout Standard
Some of the more commonly used features in activity-recognition systems
 are: mean, standard deviation, energy, entropy, correlation between axis,
 and discrete FFT coefficients
\begin_inset CommandInset citation
LatexCommand cite
key "Huynh2005"

\end_inset

.
 Obviously, not all features are of equal value.
 FFT coefficients are generally very good indicators of activity, but the
 ideal coefficients and window sizes vary depending on the exact activity
 that is being detected.
 Likewise, the choice of other features to give the best recognition rate
 varies depending on the activity being detected
\begin_inset CommandInset citation
LatexCommand cite
key "Huynh2005"

\end_inset

.
\end_layout

\begin_layout Standard
As the sensor data is received continuously, it needs to be partitioned
 somehow before features are extracted.
 Most implementations use a sliding window approach with a 50% overlap between
 windows
\begin_inset CommandInset citation
LatexCommand cite
key "Bao2004"

\end_inset

.
 A window size of 10 seconds with a 50% overlap would result in one set
 of features being computed every 5 seconds.
 The window size is normally selected to correspond to a pre-defined number
 of samples to enable fast computation of certain features - most notably
 FFTs
\begin_inset CommandInset citation
LatexCommand cite
key "Bao2004"

\end_inset

.
\end_layout

\begin_layout Standard
One challenge will be determining a set of features that are robust enough
 to perform activity analysis on, but are sufficiently inexpensive to calculate
 continually on a mobile device, where CPU speed is limited and excessive
 usage results in undesirable higher battery consumption.
\end_layout

\begin_layout Subsection
Training
\end_layout

\begin_layout Standard
In order to meaningfully classify and label activities, some kind of training
 generally needs to be performed beforehand.
 The choice of classifier affects how much offline analysis has to be done
 on the training set, and whether or not it can be adapted at run-time.
\end_layout

\begin_layout Standard
One might expect that training would best be performed in a controlled environme
nt, to reduce external influences on the user, but subjects in a laboratory
 setting are much more self-conscious about their movements, and this manifests
 itself in the data collected.
 Walking in a laboratory tends to produce acceleration data showing a consistent
 gait cycle which can be split into distinct phases, whereas walking in
 an uncontrolled setting produces data showing large fluctuations in gait
 phases and length.
 This means that classifiers trained on laboratory data may achieve a much
 lower accuracy when deployed in natural conditions
\begin_inset CommandInset citation
LatexCommand cite
key "Bao2004"

\end_inset

.
\end_layout

\begin_layout Subsection
Classification
\end_layout

\begin_layout Standard
The classification step involves feeding the features for frame into some
 kind of machine learning algorithm which can, using training data
\begin_inset Foot
status collapsed

\begin_layout Plain Layout
and any offline analysis made of that data
\end_layout

\end_inset

, determine which activity the feature-set most like represents.
 There are many different algorithms that can be used to perform the classificat
ion, some of which are discussed below.
\end_layout

\begin_layout Subsubsection
Decision trees
\end_layout

\begin_layout Standard
Decision trees are possibly one of the simplest approaches possible
\begin_inset CommandInset citation
LatexCommand cite
key "Hudson2003"

\end_inset

.
 A tree is constructed such that each node contains a test function, with
 branches for each possible discrete outcome of the function.
 This allows data to be classified with a 
\begin_inset Quotes eld
\end_inset

divide and conquer
\begin_inset Quotes erd
\end_inset

 approach.
 While high accuracy is possible in some circumstances
\begin_inset CommandInset citation
LatexCommand cite
key "Hudson2003"

\end_inset

, there are several drawbacks to decision trees: a plain decision tree has
 no way to model uncertainty - in an activity-aware system there will always
 be a degree of uncertainty as to the classification, and being able to
 measure this is an important tool.
 They also have an inductive bias which leads to a preference for the most
 general solution, and in most cases this generalisation causes many false
 results
\begin_inset CommandInset citation
LatexCommand cite
key "Shen2004"

\end_inset

.
\end_layout

\begin_layout Standard
Decision trees require the structure of the tree and the test functions
 for each node to be determined during training.
 They do not lend themselves to minor on-the-fly modifications or new activities
 that are not part of the training set.
\end_layout

\begin_layout Subsubsection
Neural networks
\end_layout

\begin_layout Standard
Neural networks are based on an extremely simplified model of the brain.
 The network consists of layers of neurons, and each neuron performs a simple
 arithmetic operation on its inputs.
 This normally consists of taking each of its inputs, multiplying it by
 a weight, and then summing all of the weighted inputs together; the resulting
 figure then becomes the neuron's output, and the input to one or more nodes
 in the next layer.
\end_layout

\begin_layout Standard
A network consists of a layer of input neurons, a layer containing one or
 more output neurons, and one or more layers of 
\begin_inset Quotes eld
\end_inset

hidden
\begin_inset Quotes erd
\end_inset

 neurons in between.
 The number of 
\begin_inset Quotes eld
\end_inset

hidden
\begin_inset Quotes erd
\end_inset

 layers, and the number of neurons within those layers must be chosen before
 training of the network begins.
 The training process will then determine the weights for each link in the
 network.
 The choice of number of layers poses a problem when designing a network,
 as too small a number can cripple the power of the network, but too large
 can cause it to be too expensive to evaluate and can possibly lead to it
 memorising erroneous data
\begin_inset CommandInset citation
LatexCommand cite
key "Dornbush2005"

\end_inset

.
\end_layout

\begin_layout Standard
Neural networks, however, do provide good accuracy and could potentially
 (although not easily) be modified on-the-fly to cope with new activities.
\end_layout

\begin_layout Subsubsection
Genetic algorithms
\end_layout

\begin_layout Standard
Genetic algorithms use the principle of natural selection to 'evolve' a
 solution to a problem.
 A set of random solutions are created, and a pre-defined fitness function
 is used to determine their relative worth.
 The best solutions are then combined together to produce the next generation
 of solutions, in a manner roughly analogous to reproduction in animals.
 Small 
\begin_inset Quotes eld
\end_inset

mutations
\begin_inset Quotes erd
\end_inset

 are also introduced into each generation to counter the effect of local
 maxima being reached.
\end_layout

\begin_layout Standard
Genetic algorithms can be combined with other techniques such as neural
 networks - the weights in the neural network can be 
\begin_inset Quotes eld
\end_inset

evolved
\begin_inset Quotes erd
\end_inset

 using genetic algorithms to create a neural network which is good as satisfying
 the fitness function.
\end_layout

\begin_layout Standard
The drawback of genetic algorithms is the need for a fitness function -
 the network will only ever be as good as the fitness function, and if you
 have a way to define what makes a good network you could in most cases
 hardcode the solution instead of evolving a network to satisfy it.
\end_layout

\begin_layout Subsubsection
Instance-based learning
\end_layout

\begin_layout Standard
Instance-based learning (IBL)
\begin_inset CommandInset citation
LatexCommand cite
key "Witten2000"

\end_inset

 algorithms are a class of 
\begin_inset Quotes eld
\end_inset

lazy
\begin_inset Quotes erd
\end_inset

 algorithms.
 They perform classification based on previously observed instances that
 have already been classified.
 There is no training required for IBLs, they're extremely adept at adapting
 to new scenarios, and they have a very low error rate
\begin_inset CommandInset citation
LatexCommand cite
key "Dornbush2005"

\end_inset

 which makes them ideal for activity-recognition.
\end_layout

\begin_layout Standard
One particular type of IBL algorithm which is frequently seen in activity-aware
 research is the K-Nearest Neighbour (KNN) algorithm
\begin_inset CommandInset citation
LatexCommand cite
key "Han2006"

\end_inset

.
 With the KNN algorithm, each sample is treated as a vector, and the distance
\begin_inset Foot
status collapsed

\begin_layout Plain Layout
the euclidean distance is usually used, but any metric will suffice
\end_layout

\end_inset

 between the sample and the existing instances is calculated.
 The sample is then classified according to the classification of the majority
 of its 
\begin_inset Formula $k$
\end_inset

 nearest neighbours.
\end_layout

\begin_layout Standard
One drawback of IBLs is that each new instance tends to be remembered for
 future use, which eventually results in large amounts of memory consumption
 and complexity when comparing distances of new samples.
 This can be partially overcome by only storing instances which would affect
 the classification of new samples
\begin_inset CommandInset citation
LatexCommand cite
key "Witten2000"

\end_inset

.
\end_layout

\begin_layout Standard
The KNN algorithm can be easily extended to support dynamic classification
 of new types of activities - if a sample is not within a certain distance
 of sufficient other samples, it can be classified as a new type of activity.
\end_layout

\begin_layout Subsubsection
Conclusion
\end_layout

\begin_layout Standard
There are numerous machine learning algorithms available and suitable for
 use in activity classification tasks.
 There has been a lot of research into their use, and all of the algorithms
 discussed have produced good results.
 Because of the lack of need for any training, however, the K-Nearest Neighbour
 algorithm appears to be the most promising for a mobile device.
 Any algorithm that needs explicit training prior to classification would
 almost certainly require a desktop application or a remote service to analyse
 the data, as it typically requires large amounts of memory and expensive
 computations.
 This either makes the application extremely cumbersome for the user (they
 have to connect their phone to a computer, transfer a file, obtain and
 run a separate application, then transfer some file back), or puts a large
 resource burden onto the distributor (having to remotely analyse all of
 the data from all users would require dedicated hardware for any more than
 a few users).
\end_layout

\begin_layout Section
Mobile telephones
\end_layout

\begin_layout Standard
It's hard to overstate the ubiquity of mobile telephones at present.
 In 2003, over a billion mobile telephones were sold - six times as many
 as the number of personal computers
\begin_inset CommandInset citation
LatexCommand cite
key "Eagle2004"

\end_inset

.
 In 2007, this same figure describes the number of cameraphones sold
\begin_inset CommandInset citation
LatexCommand cite
key "Reynolds2008"

\end_inset

, clearly representing a substantial growth in sales and advancements in
 the technology.
 In fact, mobile telephones are the fastest adopted technology in human
 history
\begin_inset CommandInset citation
LatexCommand cite
key "Eagle2004"

\end_inset

.
 This ubiquity, coupled with the fact that mobile telephones are comfortably
 carried around on a daily basis by most of their users, makes them a very
 attractive alternative to more traditional platforms used for activity-aware
 research, which typically involved bulky or inconvenient apparatus that
 was expensive to manufacture
\begin_inset CommandInset citation
LatexCommand cite
key "Schmidt2008"

\end_inset

 and made users very self-conscious.
\end_layout

\begin_layout Subsection
iPhone
\end_layout

\begin_layout Standard
There have been several published works related to activity-recognition
 on the iPhone.
 The similarity between iPhone and Android platforms means that many of
 the concepts developed for or used on the iPhone are applicable to both.
\end_layout

\begin_layout Subsubsection
iLearn
\end_layout

\begin_layout Standard

\noun on
iLearn
\noun default

\begin_inset CommandInset citation
LatexCommand cite
key "Schmidt2008"

\end_inset

 is a suite of three tools - 
\noun on
iLog
\noun default
, 
\noun on
iModel,
\noun default
 and 
\noun on
iClassify
\noun default
 - which together allow for real-time classification of low-level activities.
 
\noun on
iLog
\noun default
 is run on the user's iPhone and allows the user to specify which activity
 they will be performing.
 The application then records raw sensor data from the iPhone's three-axis
 accelerometer and 124 features computed from this data in real-time.
 The data is then stored on the device, annotated with the selected activity.
\end_layout

\begin_layout Standard
The training data collected by 
\noun on
iLog
\noun default
 is then transferred to a desktop computer where 
\noun on
iModel
\noun default
 uses a Na√Øve Bayesian Network (NBN) to create a model which can be used
 to classify future input.
 The choice of NBNs was based on their ability to classify a set of trial
 data correctly, and the low computational cost of classifying data once
 the model has been generated.
\end_layout

\begin_layout Standard
Once the model has been created, it is transferred back to the device where
 it is used by 
\noun on
iClassify
\noun default
.
 This provides an API for other applications, and allows them to register
 for a callback which it publishes the user's current activity to every
 second.
\end_layout

\begin_layout Standard
Unfortunately, neither the source code nor the API are published.
 The inability to run background processes on the iPhone suggests that any
 
\begin_inset Quotes eld
\end_inset

API
\begin_inset Quotes erd
\end_inset

 would have to be more like a framework where the third-party developer
 has to re-engineer their application to use the 
\noun on
iClassify
\noun default
 application as a base.
 This is undesirable as it makes it extremely difficult to adapt existing
 applications to use the activity-aware API, and is a very cumbersome way
 of providing what could be a very minor piece of functionality for the
 application.
\end_layout

\begin_layout Subsubsection
Evaluation
\end_layout

\begin_layout Standard
\begin_inset CommandInset citation
LatexCommand citet
key "Miluzzo2009"

\end_inset

 present an evaluation of the iPhone for use in 
\begin_inset Quotes eld
\end_inset

people-centric sensing applications
\begin_inset Quotes erd
\end_inset

.
 One of the major drawbacks highlighted is that the iPhone does not support
 applications which run in the background.
 This means that any application wishing to perform continuous real-time
 activity detection would need to run as a foreground process, preventing
 the user from using the device for any other function.
\end_layout

\begin_layout Standard
The research also shows that the computational compatibility of the iPhone
 is more than sufficient to perform the necessary calculations for a typical
 activity-recognising application, which suggests that any modern smart
 phone would be capable of these.
\begin_inset Note Note
status open

\begin_layout Plain Layout
Multitasking
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Android
\end_layout

\begin_layout Standard
While the Android platform is relatively new, it is rapidly gaining market
 share on the more established mobile operating systems.
 A December 2009 survey
\begin_inset CommandInset citation
LatexCommand cite
key "ChangeWave2010"

\end_inset

 shows that 21% of respondents want their next smartphone purchase to run
 Android, a 350% increase from the same survey conducted three months prior.
 This is compared to the iPhone, which dropped 4% to 28% in the same time
 period.
 Gartner, a respected IT research firm, predicts that by 2012, Android will
 be the second most popular mobile operating system globally
\begin_inset CommandInset citation
LatexCommand cite
key "ComputerWorld2010"

\end_inset

.
\end_layout

\begin_layout Standard
In addition to its rapidly increasing popularity, the Android platform offers
 several advantages over the iPhone platform.
 Most notably is the ability to run background processes (called 
\noun on
services
\noun default
), which will allow a classifier application to run without interfering
 with the user's normal use of their mobile telephone.
 In addition, the Android OS provides access to the Bluetooth and GSM stacks,
 allowing for data from both to be used for activity detection.
\end_layout

\begin_layout Standard
The ability to run a background process will enable a proper API for sharing
 activity data with other applications, which will allow third-party developers
 to make their applications context-aware with relatively little work on
 their part.
 This is extremely desirable as it will allow rapid prototyping of applications,
 which will hopefully lead to innovative new uses of activity classification.
\end_layout

\begin_layout Standard
While it is purported
\begin_inset CommandInset citation
LatexCommand cite
key "Garakani2009"

\end_inset

 that there is research being done on bringing activity-awareness to Android
 platforms, there does not seem to be any work published on this matter
 or any applications available to support it.
 While there a small number of self-proclaimed 
\begin_inset Quotes eld
\end_inset

context-aware
\begin_inset Quotes erd
\end_inset

 applications for Android, this context is almost exclusively limited to
 geolocation.
 This project will therefore produce one of the first publicly available
 activity-aware applications for the Android platform.
\end_layout

\begin_layout Section
Location analysis
\begin_inset CommandInset label
LatexCommand label
name "sec:Location-analysis"

\end_inset


\end_layout

\begin_layout Standard
Location-based services are currently undergoing an 
\begin_inset Quotes eld
\end_inset

explosion
\begin_inset Quotes erd
\end_inset


\begin_inset CommandInset citation
LatexCommand cite
key "Bellavista2008"

\end_inset

, thanks to improvements in technology, and greater openness on the part
 of service providers and handset manufacturers.
 All modern smartphone platforms have a geolocation stack, usually backed
 by a GPS chipset and in most cases augmented with either a database of
 known cell tower locations, or a map of known wifi network identifiers
 and locations, or both.
 The two databases allow for rough geolocation when GPS is not available,
 or for greatly decreased lookup time when a GPS lock is available.
\end_layout

\begin_layout Standard
However, while the geolocation stack is a rich source of data, it is a poor
 source of information.
 A latitude/longitude pair may describe the user's exact location, but a
 user would be hard-pressed to tell the difference between the latitude/longitud
e of their home, place of work, or of somewhere in between the two with
 no real significance.
 A great deal of research has therefore been devoted to detecting meaningful
 locations from GPS traces.
\end_layout

\begin_layout Standard
\begin_inset Quotes eld
\end_inset

Place recognition
\begin_inset Quotes erd
\end_inset

 has two phases: learning and recognising.
 An initial learning phase analyses a sensor log and segments the data into
 places where the device is stable (stationary), and designates this as
 a 
\begin_inset Quotes eld
\end_inset

waypoint
\begin_inset Quotes erd
\end_inset

.
 It then merges 
\begin_inset Quotes eld
\end_inset

waypoints
\begin_inset Quotes erd
\end_inset

 that appear to identify the same place being visited multiple times.
 The second phase uses these learned waypoints to recognise when the device
 is revisiting a place, and therefore also when the device is not visiting
 a previously known place (for example when it is moving between two)
\begin_inset CommandInset citation
LatexCommand cite
key "Hightower2005"

\end_inset

.
\end_layout

\begin_layout Standard
Unfortunately, quite a lot of research into location analysis uses GPS 
\begin_inset Quotes eld
\end_inset

blackspots
\begin_inset Quotes erd
\end_inset

 to identify useful places
\begin_inset CommandInset citation
LatexCommand cite
key "Nurmi2006,Liao2007b"

\end_inset

.
 With older GPS chipsets, the satellite signal would be lost when the user
 entered a building, and this allowed an inference that the current location
 was probably a place of interest.
 However, modern GPS chipsets receive a signal in most indoor locations.
 It is possible that a decrease in signal strength or number of locked satellite
s may still occur, or that GSM signal strength could be used instead, but
 these ideas have not been widely explored at present.
\end_layout

\begin_layout Standard
There is, however, plenty of research relating to the use of location data
 outdoors.
 One application
\begin_inset CommandInset citation
LatexCommand cite
key "Liao2007b"

\end_inset

 learns not only the user's frequently visited places, but the method of
 transport used between them and the typical routes taken.
 It can then offer instructions showing the user how to go from place to
 place, or issue alerts if the user appears to be going the wrong way (by
 getting on the wrong bus, for instance).
 The ability to correctly infer the user's destination would be extremely
 useful in a context-aware system: a user walking to do their grocery shopping
 is almost certainly going to want to interact with their phone differently
 than a user on a bus going to work.
\end_layout

\begin_layout Section
Bluetooth
\begin_inset CommandInset label
LatexCommand label
name "sec:Bluetooth"

\end_inset


\end_layout

\begin_layout Standard
The user's context depends on not only what they are doing, where they are
 doing it, but also who they are with.
 Sitting and eating lunch with a manager is quite a different context to
 sitting and eating lunch with a spouse.
 It would therefore be desirable to be able to identify between different
 people when performing context analysis.
\end_layout

\begin_layout Standard
One of the few ways that a mobile telephone can identify other people is
 by searching for 
\emph on
their
\emph default
 mobile telephones.
 This can be done by scanning for Bluetooth devices, which involves broadcasting
 a 
\begin_inset Quotes eld
\end_inset

device inquiry
\begin_inset Quotes erd
\end_inset

 message; if a device chooses to answer the inquiry, it discloses its unique
 MAC address and device class
\begin_inset Foot
status collapsed

\begin_layout Plain Layout
the device class tells us whether the device is a computer or a mobile telephone
, for example
\end_layout

\end_inset

.
 Unfortunately, this requires the person to not only be carrying a mobile
 telephone, but a Bluetooth-enabled model, and for them to have configured
 their device to have Bluetooth enabled and to be 
\begin_inset Quotes eld
\end_inset

visible
\begin_inset Quotes erd
\end_inset

.
 A study in 2004
\begin_inset CommandInset citation
LatexCommand cite
key "Eagle2004"

\end_inset

 found that only 1 in 150 people had such a configured device on a university
 campus.
 This figure will undoubtedly be greater now, and may well be greater when
 in public, but it highlights that only a handful of people may be detectable
 via their Bluetooth devices.
\end_layout

\begin_layout Standard
A study in 2006
\begin_inset CommandInset citation
LatexCommand cite
key "Nicolai2006"

\end_inset

 used a similar technique to monitor the social context of the user, introducing
 the idea of 
\begin_inset Quotes eld
\end_inset

familiar
\begin_inset Quotes erd
\end_inset

 people, 
\begin_inset Quotes eld
\end_inset

unfamiliar
\begin_inset Quotes erd
\end_inset

 people and 
\begin_inset Quotes eld
\end_inset

familiar strangers
\begin_inset Quotes erd
\end_inset

.
 These labels were applied based on the number of times their Bluetooth
 devices were detected 
\begin_inset Foot
status collapsed

\begin_layout Plain Layout
and by extension the number of times the user had come into contact with
 them
\end_layout

\end_inset

.
 While the definition of 
\begin_inset Quotes eld
\end_inset

familiar
\begin_inset Quotes erd
\end_inset

 and 
\begin_inset Quotes eld
\end_inset

unfamiliar
\begin_inset Quotes erd
\end_inset

 are quite obvious, 
\begin_inset Quotes eld
\end_inset

familiar strangers
\begin_inset Quotes erd
\end_inset

 is a new class of people used to describe those who the user encounters
 repeatedly, but doesn't interact with.
 This may include neighbours that are passed on the street, or fellow commuters
 on a journey into work.
 The number of people in each of those groups (and any changes in those
 numbers) can be used to infer how 
\begin_inset Quotes eld
\end_inset

comfortable
\begin_inset Quotes erd
\end_inset

 the user feels with their social context, and whether their current activity
 is part of a normal routine or is novel.
\end_layout

\begin_layout Standard
This research has, to date, not been readily combined with activity-aware
 applications, and this project will aim to integrate the results of Bluetooth
 scanning with 
\begin_inset Quotes eld
\end_inset

classical
\begin_inset Quotes erd
\end_inset

 activity classification techniques and to evaluate whether it provides
 any benefit.
\end_layout

\begin_layout Section
Power management
\begin_inset CommandInset label
LatexCommand label
name "sec:Power-management"

\end_inset


\end_layout

\begin_layout Standard
One major consideration when deploying an application on a mobile device
 is the amount of power it will use.
 An application constantly polling any one sensor can reduce battery life
 significantly, and an application which kept all available sensors active
 (in addition to doing CPU-heavy analysis on them) would drain the battery
 in a typical smartphone in a matter of hours.
 A context-aware application is not very useful for a user if they can only
 use their telephone for an hour or two before it needs recharging!
\end_layout

\begin_layout Standard
One solution
\begin_inset CommandInset citation
LatexCommand cite
key "Wang2009"

\end_inset

is to only use one or two sensors to monitor the user's activity until it
 appears to be transitioning.
 For example, if the user is believed to be walking, the application only
 needs to periodically check either the accelerometer (to confirm the user
 is still making walking motions) or GPS (to confirm the distance traveled
 is still consistent with walking) to know that their activity has not changed.
 As soon as the user's behaviour becomes inconsistent with walking, the
 application can bring other sensors online until it has successfully reclassifi
ed the activity, and then resume monitoring with minimal sensors.
\end_layout

\begin_layout Standard
Another option
\begin_inset CommandInset citation
LatexCommand cite
key "Wang2009"

\end_inset

 (which can be used in conjunction) is to only enable sensors for a short
 amount of time, and then sleep for a period before reactivating them.
 The 
\begin_inset Quotes eld
\end_inset

duty cycle
\begin_inset Quotes erd
\end_inset

 suggested for accelerometers is 6 second of sensing followed by 10 seconds
 of sleeping.
 The six second window is enough time to allow for capturing a full range
 of motion (several complete strides) if the user is walking or running,
 and then the ten second sleep stops the accelerometer using battery power
 until the next cycle.
 This process obviously means that a sudden switch in activity will not
 be noticed immediately, but a delay of a few seconds is acceptable as most
 activities will last for minutes or longer.
\end_layout

\begin_layout Standard
The battery life on modern smartphones rarely exceeds 24 hours of typical
 use, so it is extremely important that any applications developed for this
 project does not significantly reduce this.
 A balance between prompt detection and notification of activity changes
 and battery use by sensors and processing algorithms will need to be found.
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Part
Accelerometer classification
\end_layout

\begin_layout Section
Sensor Logger application
\end_layout

\begin_layout Standard
The primary component of context that this project aims to expose is the
 user's activity.
 The main factor in determining a user's activity is the data retrieved
 from the device's accelerometers.
 This gave rise to the project's first published application, titled 
\noun on
Sensor Logger
\noun default
.
 The first version of 
\noun on
Sensor Logger
\noun default
 consisted of a single activity containing a large amount of text describing
 the project, an editable text field where the user could name their activity,
 and a button which initiated logging.
\end_layout

\begin_layout Standard
Once the user tapped the 'Start' button, the application launched a service
 which registered with the device's SensorManager and requested fast updates
 from both the accelerometer and the magnetic field sensor.
 Every 50ms the last value received from each axis on each sensor was written
 along with a timestamp to a file on the device.
 After 1024 samples were collected (a total of around 51 seconds), the service
 launched an uploader service and terminated itself.
 The uploader service read the file from the device's flash memory, opened
 a HTTP connection to the project website, and submitted the data to a PHP
 script.
 The PHP script in turn stored the data in a MySQL database.
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
Market
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
Diagram of components
\end_layout

\end_inset


\end_layout

\begin_layout Section
Manual classification
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename website-windows.png
	height 70pheight%
	rotateAngle 90

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Website for manually classifying windows
\begin_inset CommandInset label
LatexCommand label
name "fig:Website-for-manually"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset

Once the sensor data was logged in the database, a web interface provided
 a graphical representation of the acceleration and magnetic field readings.
 It also allowed a handful of authenticated users to manually classify overlappi
ng 
\begin_inset Quotes eld
\end_inset

windows
\begin_inset Quotes erd
\end_inset

 of 128 data points.
 The classification portion of the website is shown in 
\begin_inset CommandInset ref
LatexCommand prettyref
reference "fig:Website-for-manually"

\end_inset

; it shows the first six overlapping windows for one submission, with the
 third window highlighted because the user's cursor is over the corresponding
 dropdown.
 Users of this system could define activities in a hierarchical fashion,
 starting with two root nodes - 'CLASSIFIED' and 'UNCLASSIFIED'.
 Early data submitted resulted in a classification hierarchy of:
\end_layout

\begin_layout Itemize
UNCLASSIFIED
\end_layout

\begin_deeper
\begin_layout Itemize
PENDING (not yet manually assigned)
\end_layout

\begin_layout Itemize
UNKNOWN (unable to determine actual activity from user label)
\end_layout

\begin_layout Itemize
DNI (short for 
\begin_inset Quotes eld
\end_inset

Do Not Include
\begin_inset Quotes erd
\end_inset

, for windows which appear erroneous)
\end_layout

\end_deeper
\begin_layout Itemize
CLASSIFIED
\end_layout

\begin_deeper
\begin_layout Itemize
WALKING
\end_layout

\begin_deeper
\begin_layout Itemize
STAIRS (not used in itself)
\end_layout

\begin_deeper
\begin_layout Itemize
UP
\end_layout

\begin_layout Itemize
DOWN
\end_layout

\end_deeper
\end_deeper
\begin_layout Itemize
IDLE (not used in itself)
\end_layout

\begin_deeper
\begin_layout Itemize
SITTING
\end_layout

\begin_layout Itemize
STANDING
\end_layout

\end_deeper
\begin_layout Itemize
VEHICLE (not used in itself)
\end_layout

\begin_deeper
\begin_layout Itemize
CAR
\end_layout

\begin_layout Itemize
BUS
\end_layout

\end_deeper
\begin_layout Itemize
DANCING
\end_layout

\end_deeper
\begin_layout Standard
It was observed that many samples had erroneous data either at the start
 or the end of the recording.
 This was a result of the user putting the device away in a pocket (as instructe
d) or picking it back up to check the results.
 A classification of 'DNI', short for 'Do Not Include' was therefore introduced
 which allowed the erroneous windows to be summarilary excluded from later
 analysis.
 Later iterations of the Sensor Logger application included a 10 second
 delay at the start to give the user time to put the device away, and sounded
 an audible alert at the end, which reduced the number of records submitted
 with bad data.
\end_layout

\begin_layout Standard
Another problem with the user submitted data was that some activity descriptions
 didn't make sense.
 With the earliest versions of the Sensor Logger, a significant number of
 users entered their own name or a non-sensical string into the textbox
 labelled 
\begin_inset Quotes eld
\end_inset

Activity name
\begin_inset Quotes erd
\end_inset

.
 This suggested that users were either not reading or misunderstanding the
 instructions.
 A classification for 'UNKNOWN' was introduced to facilitate removal of
 the records where classifications couldn't be inferred from the activity
 name.
\end_layout

\begin_layout Section
Feature extraction
\end_layout

\begin_layout Standard
Once a reasonable sample of data had been recorded, the PHP script was modified
 to allow exporting of all classified windows.
 It produced a plain text file containing the sensor readings and timestamp
 for each of the 128 points in each window, as well as the manually-applied
 classification.
 It did not include information as to which windows were from the same sample,
 or the orginal user-supplied activity name.
\begin_inset Note Note
status open

\begin_layout Plain Layout
Sample in appendix
\end_layout

\end_inset


\end_layout

\begin_layout Standard
A Java program was written which imported the exported data.
 A series of 'feature extractors' were written.
 These calculated the:
\end_layout

\begin_layout Itemize
maximum
\end_layout

\begin_layout Itemize
minimum
\end_layout

\begin_layout Itemize
range
\end_layout

\begin_layout Itemize
median
\end_layout

\begin_layout Itemize
mean
\end_layout

\begin_layout Itemize
absolute mean
\end_layout

\begin_layout Standard
Each of these extractors was run over the set of 128 data points from each
 axis on each sensor, giving a total of 36 features.
 It was planned to add further features including fast fourier transforms
 and energy, as suggested by multiple papers consulted in background research.
\end_layout

\begin_layout Standard
The program was modified to export the features and classification of each
 window in ARFF
\begin_inset Note Note
status open

\begin_layout Plain Layout
ref
\end_layout

\end_inset

 (Attribute Relation File Format).
 This is a format used by Weka
\begin_inset Note Note
status open

\begin_layout Plain Layout
ref
\end_layout

\end_inset

, a popular data mining suite developed by the University of Waikato.
\begin_inset Note Note
status open

\begin_layout Plain Layout
Sample in appendix
\end_layout

\end_inset

 The ARFF file was imported into Weka and analysed.
\end_layout

\begin_layout Standard
It was found that Weka could correctly classified 
\begin_inset Note Note
status open

\begin_layout Plain Layout
99%
\end_layout

\end_inset

 of activities (measured using a 
\begin_inset Note Note
status open

\begin_layout Plain Layout
hold-one cross validation
\end_layout

\end_inset

) using a K-Nearest Network algorithm with K = 1.
 Furthermore, it became apparent that the error did not significantly increase
 when the 36 features were reduced to just four - the absolute mean and
 the range of the Y and Z accelerometer readings.
 Given the low cost of calculating these features and the very high detection
 rate, further research into other features such as FFTs was not performed.
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
Trumpet blowing
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The application was again modified to read the exported data, calculate
 the four interesting features, and create a mapping of data points to activity.
 This map was then serialised and written to a file 
\begin_inset Note Note
status open

\begin_layout Plain Layout
expand
\end_layout

\end_inset

.
\end_layout

\begin_layout Section
On-device classification
\end_layout

\begin_layout Standard
The serialised model was bundled with a new version of the Sensor Logger
 application, along with a completely redesigned user interface.
 The application now consisted of a series of activities: on opening the
 application, the user is presented with an introduction activity which
 explains what the application does and the aims of the project; when they
 click the 'next' button a 10 second countdown is displayed with the instruction
 to put the phone away repeated.
 During the data collection period an animated pattern of dots is displayed
 so the user knows the application is still working if they look at it.
 When data collection is completed, the device adds a notification with
 sound and vibrate settings, and displays another progress screen while
 a background service analyses the data.
 The result of the classification is then displayed prominently and the
 user is presented with two buttons - one to confirm the classification
 and one to reject and correct it.
 The on-device classification (and any correction made to it) is submitted
 along with all the data previously submitted.
 The user is then presented with a 'Thank you' message, and a unique link
 to the project website where they can view graphs of their activities.
\begin_inset Note Note
status open

\begin_layout Plain Layout
Mess!
\end_layout

\end_inset


\end_layout

\begin_layout Section
Activity Recorder application
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
Screenshot
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The Activity Recorder application was the second application published on
 the market.
 In contrast to the sensor logger, it only records the two relevant axes
 of the accelerometer, and all data is kept in memory
\begin_inset Note Note
status open

\begin_layout Plain Layout
on the heap?
\end_layout

\end_inset

 instead of being written to a file.
\end_layout

\begin_layout Standard
The activity recorder consists of a background service which records 128
 samples of sensor data once every 30 seconds.
 At all other times, the accelerometer is not accessed to conserve battery
 power.
 The samples are then classified using the same model as the Sensor Logger
 application, and the resulting activity is appended to a list.
 
\begin_inset Note Note
status open

\begin_layout Plain Layout
Adjacent
\end_layout

\end_inset

 samples which are classified as the same activity are merged together.
\end_layout

\begin_layout Standard
The user interface displays a list of activities, along with their start
 time and duration in minutes or hours.
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Part
Other sensors
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Part
Places
\end_layout

\begin_layout Section
Use of GPS/GSM blackspots
\end_layout

\begin_layout Standard
As discussed in 
\begin_inset CommandInset ref
LatexCommand prettyref
reference "sec:Location-analysis"

\end_inset

 a lot of existing research into identifying interesting places relied on
 the fact that with hardware that is now 5-10 years old, you could not reliably
 get a GPS signal indoors.
 Thus whenever the user remained somewhere without a GPS signal it was likely
 that they were spending time indoors, and therefore their current location
 would be noteworthy.
\end_layout

\begin_layout Standard
Unfortunately, modern GPS hardware is much more sensitive and can quite
 easily get a signal indoors in most circumstances.
 One possible solution to this was to monitor the strength of either the
 GPS lock or the GSM signal, and attempt to determine whether or not a differenc
e was noticable.
 An experiment was therefore conducted to record the GPS and GSM status
 for multiple indoor and outdoor locations.
\end_layout

\begin_layout Standard
\begin_inset Float table
placement bh
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Tabular
<lyxtabular version="3" rows="9" columns="4">
<features>
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Location
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
GSM strength
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
GPS satellites
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
GPS time to fix
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Indoors
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-101 dBm
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
10
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
<1 sec
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Outdoors
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-101 dBm
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
8
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
<1 sec
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Indoors
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-71 dBm
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2 sec
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Outdoors
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-67 dBm
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
7
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2 sec
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Indoors
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-67 dBm
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
11
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
<1 sec
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Outdoors
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-67 dBm
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
10
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3 secs
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Indoors
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-67 dBm
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
10
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
<1 sec
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Outdoors
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-43 dBm
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
10
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
<1 sec
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
GPS and GSM strengths
\begin_inset CommandInset label
LatexCommand label
name "tab:GPS-and-GSM"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset

At four separate indoor locations, the third-party 
\noun on
GPS Status
\noun default
 application was used to observe the number of satellites the device was
 receiving a signal from, and the amount of time it took to acquire a fix
 on all of those satellites.
 The GSM signal strength as reported by the device's built in debugging
 tools was also recorded.
 The device was then moved outdoors to the nearest appropriate open area
 (footpath, outdoor seating area, etc), and the process was repeated.
 The results are summarised in 
\begin_inset CommandInset ref
LatexCommand prettyref
reference "tab:GPS-and-GSM"

\end_inset

.
\end_layout

\begin_layout Standard
While the indoor GSM strength is lower than the corresponding outdoor strength
 in two out of the four samples, it is still significantly stronger than
 the weakest recorded indoor or outdoor signal.
 In the other two cases the signal strength was the same for both indoors
 and outdoors.
 The GSM signal strength therefore seems to be a poor indicator of whether
 or not the user is indoors - it would have to be continually monitored
 to detect a drop in signal strength, and the (limited) experimental data
 shows that this would have a 50% false negative rate.
 The experiment does not allow us to reason about false positives, but it
 is easy to imagine that many circumstances would give rise to drops in
 signal strength - the most obvious being moving away from the cell tower.
\end_layout

\begin_layout Standard
The GPS results show even less correlation between indoor and outdoor readings.
 In two out of the four locations, the indoor test identified more satellites
 than the outdoor test - the opposite to what would be expected.
 This could be because the indoor locations were typically above ground
 level - the extra altitude may be more beneficial to obtaining a lock than
 the obstruction of the building itself.
 It seems more likely, however, that the numbers are not correlated in any
 way, and a larger experiment would reveal it to be random variance.
 Similarly, the time taken to lock the satellites is typically very small,
 but in a few situations there is a noticable delay.
 The location which resulted in a three second lock time was repeated after
 a thirty second pause and obtained a sub-second lock time, but the original
 data was included in the results.
\end_layout

\begin_layout Standard
The experiment, although extremely limited in size, shows that it is unlikely
 that GSM strength or GPS metadata would be useful in determining interesting
 places.
 Alternative methods therefore had to be considered.
\end_layout

\begin_layout Section
Detecting places by time spent
\end_layout

\begin_layout Standard
Without information about whether or not the user is indoors, the next best
 method to detect interesting places is by monitoring the amount of time
 the user spends there.
 It stands to reason that a location where the user is only present fleetingly
 as they pass through is less important than somewhere they spend half a
 day.
\end_layout

\begin_layout Standard
The Android operating system provides two methods of determining the user's
 location - 
\begin_inset Quotes eld
\end_inset

coarse
\begin_inset Quotes erd
\end_inset

, which uses a cell tower and WiFi access point database, and 
\begin_inset Quotes eld
\end_inset

fine
\begin_inset Quotes erd
\end_inset

 which uses the device's GPS chipset.
 While 
\begin_inset Quotes eld
\end_inset

coarse
\begin_inset Quotes erd
\end_inset

 is less accurate than using GPS, it also uses significantly less battery
 power.
 Brief testing revealed that while GPS regularly obtained accuracies of
 below five metres, 
\begin_inset Quotes eld
\end_inset

network
\begin_inset Quotes erd
\end_inset

 location (using cell tower IDs and a built-in database) obtained accuracies
 in the region of 500 metres.
 Network location augmented with the built-in database of WiFi access point
 locations obtained accuraries in the same region as GPS.
 However, WiFi augmentation only works when the user has elected to enable
 WiFi on their device, and this puts a large drain on the battery.
\end_layout

\begin_layout Standard
As the most important places a user typically visits will be much greater
 than 500 metres apart, 
\begin_inset Quotes eld
\end_inset

coarse
\begin_inset Quotes erd
\end_inset

 location will was used for all location-related tasks in the project.
 Because of this large inaccuracy, places could not be represented by a
 single point but must have a radius to compensate for the inaccuracy.
 Based on earlier experimentation, this radius was fixed at 500 metres.
\end_layout

\begin_layout Standard
A new 
\begin_inset Quotes eld
\end_inset

place
\begin_inset Quotes erd
\end_inset

 is identified when the user remains within 500 metres of a point for at
 least 3 minutes.
 This figure is, hopefully, long enough to eliminate places where the user
 is temporarily held up (such as traffic lights), but short enough to include
 places the user visits but doesn't remain for a long length of time (such
 as supermarkets).
 When implementing this algorithm, care was taken to ensure that the length
 of time was defined as a constant and so could easily be changed if experimenta
l data showed that it was either too long or too short.
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Part
The 
\noun on
Context Analyser
\noun default
 and applications
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Part
Evaluation
\end_layout

\begin_layout Section
Reports
\end_layout

\begin_layout Standard
The results of the experimentation described in section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Experimentation"

\end_inset

 should be written up as a report.
 The reports must include the data collected in each of the experiments,
 the conclusions drawn from those, and the impact of the results of the
 experiment on the project deliverables.
\end_layout

\begin_layout Section
Deliverables
\end_layout

\begin_layout Standard
On successful completion of the project, there should be three deliverable
 applications as specified in section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Deliverables"

\end_inset

.
 These can be tested and evaluated in a variety of manners:
\end_layout

\begin_layout Subsection
Unit tests
\end_layout

\begin_layout Standard
Throughout the development of the project, unit tests should be created
 to test key functionality of all applications.
 It is expected that at the completion of the project, all unit tests should
 pass successfully, and they will have a code coverage of 80% or above.
\end_layout

\begin_layout Subsection
System tests
\end_layout

\begin_layout Standard
The classifier application should also have a suite of system tests.
 These should consist of a set of fake or pre-recorded inputs which are
 fed into the application in place of raw sensor data.
 The output of the classifier (via the API) can then be compared to expected
 output for the data.
\end_layout

\begin_layout Subsection
User acceptance testing
\end_layout

\begin_layout Standard
The Locale addon and context-aware home screen should be subject to user
 acceptance testing for evaluation.
 This should take the form of providing the applications to multiple end
 users, allowing them to use them for a period of time (providing instructions
 for certain tasks to complete).
 The users should then be presented with a questionnaire which they can
 use to evaluate the functionality, utility and design of the applications.
\end_layout

\begin_layout Subsubsection
Android market
\end_layout

\begin_layout Standard
In addition to providing the applications to a closed set of users, the
 applications should be published to the Android market.
 This will allow any owner of a compatible Android device to download and
 use the applications.
 The market also allows users to rate the application and leave comments,
 which will be an extremely useful method of evaluating the success of the
 applications.
\end_layout

\begin_layout Standard
As part of this, the classifier application/framework will be published,
 and should include instructions for developers detailing how they can make
 their applications context-aware.
 The interest expressed and number of applications which use it (if any)
 will be an indicator of the effectiveness of the API and its documentation.
\end_layout

\begin_layout Subsection
Classification scope
\end_layout

\begin_layout Standard
The classifier should be able to classify the following activities:
\end_layout

\begin_layout Itemize
walking
\end_layout

\begin_layout Itemize
running
\end_layout

\begin_layout Itemize
standing
\end_layout

\begin_layout Itemize
sitting
\end_layout

\begin_layout Itemize
traveling in a vehicle
\end_layout

\begin_layout Standard
These should be evaluated by means of a leave-one-out cross-validation test,
 with data collected from one or more users and annotated by hand.
 It is expected that the classifier should correctly classify all activities
 with an accuracy of at least 70%, within 30 seconds of the activity being
 started.
\end_layout

\begin_layout Subsection
Resource usage
\end_layout

\begin_layout Standard
Finally, the applications should be evaluated based on their resource usage.
 One of the main concerns will be battery usage (caused both by the application
 using processor time, and activating sensors), but attention must also
 be paid to memory consumption (especially after extended use).
 The goal should be to ensure that the resource usage of the applications
 in this project do not adversely impact the functionality of the device;
 that is, battery life should not be reduced so significantly that it requires
 users to change their normal charging behaviour, and memory usage should
 not be so high as to cause other applications to become sluggish or be
 closed by the operating system.
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Part
Conclusion
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Part
Appendices
\end_layout

\begin_layout Section
\start_of_appendix
User Guide - Context Analyser
\end_layout

\begin_layout Standard
Welcome to the 
\noun on
Context Analyser
\noun default
.
 This application analyses your 
\emph on
context
\emph default
 as you carry your phone around with you performing day-to-day activities.
 Other applications can query your context information and enhance their
 behaviour so that they're more relevant to what you're doing.
\end_layout

\begin_layout Standard
The context analyser currently provides the following context information:
\end_layout

\begin_layout Itemize
Your activity
\end_layout

\begin_layout Itemize
Your location
\end_layout

\begin_layout Itemize
Your predicted destination, if you're not at a known location
\end_layout

\begin_layout Standard
It does this by gathering data from your phone's accelerometers and location
 provider.
 Data is recorded for a few seconds once a minute, to preserve your battery
 life.
\end_layout

\begin_layout Standard
For your 'activity', the context analyser tries to detect whether you are
 walking, sitting, standing, or in a vehicle.
 It can also expand on these to detect the difference between a car and
 a bus, and walking normally and walking up or down stairs.
 Future updates may add more activities.
\end_layout

\begin_layout Standard
For your location and destination, the context analyser deals in 'places'.
 These are locations up to 500m wide where you have spent several minutes
 not moving.
 A place could correspond to your home, office, favourite coffee shop or
 a bus stop you frequently wait at.
 When you move between places, the context analyser notes which activities
 it thought you were performing, and stores these as a 'journey' which links
 the two places.
 When you next set off from one of these, it can compare your activities
 and see if it can guess where you're heading.
\end_layout

\begin_layout Standard
There is very little you can do with the context analyser on its own.
 It's built as a tool for other applications to hook into.
 
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename contextanalyser-featured.png

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Featured applications
\begin_inset CommandInset label
LatexCommand label
name "fig:Featured-applications"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset

You can see some of these featured applications listed when you open the
 context analyser (see 
\begin_inset CommandInset ref
LatexCommand prettyref
reference "fig:Featured-applications"

\end_inset

) .
 Simply click on one of them and the Android market will open for you to
 view or install your chosen app.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename contextanalyser-menu.png

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
Disable service button
\begin_inset CommandInset label
LatexCommand label
name "fig:Disable-service-button"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset

The context analyser will run a background service as soon as you open the
 application, or whenever another application requests data from it.
 If you wish to disable the background service (which will stop the context
 analyser from detecting places or determining your activity), press the
 
\noun on
menu
\noun default
 button and select the 
\noun on
Disable service
\noun default
 option (see 
\begin_inset CommandInset ref
LatexCommand prettyref
reference "fig:Disable-service-button"

\end_inset

).
 The background service will not run until you repeat the procedure and
 select 
\noun on
Enable service
\noun default
.
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Section
User Guide - Places
\end_layout

\begin_layout Standard
The 
\noun on
places
\noun default
 application shows you all of the places detected by the 
\noun on
Context Analyser
\noun default
, and the journeys you make in between them.
 The 
\noun on
Context Analyser
\noun default
 is a tool which tries to determine your current activity and location,
 and your destination if you're on the move.
 If you don't have the 
\noun on
Context Analyser
\noun default
 installed, you'll be prompted to install it from the market.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename places-normal.png

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Places application
\begin_inset CommandInset label
LatexCommand label
name "fig:Places-application"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset

The places application displays a map and marks each detected place with
 an orange star.
 Places you've travelled between are connected with a red line - the thicker
 the line, the more frequently you make that journey.
 In 
\begin_inset CommandInset ref
LatexCommand prettyref
reference "fig:Places-application"

\end_inset

, you can see two places with a very frequently made journey between them.
\end_layout

\begin_layout Standard
You can pan the map by dragging it around with your finger, or by moving
 your phone's trackball (if it has one).
 To zoom in and out, tap the screen and wait two seconds and the zoom controls
 will appear at the bottom of the map.
 Simply tap either button to zoom in or out.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename places-toast.png

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Place details
\begin_inset CommandInset label
LatexCommand label
name "fig:Place-details"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset

To see more information about a place, simply tap on its star.
 A small 
\emph on
toast
\emph default
 will appear giving you the name of the place, the number of visits, and
 the date and time of your last visit.
 Names are determined automatically by geocoding the latitude and longitude
 to a nearby place name - this could be the name of a street, a nearby landmark
 or a side alley.
 
\begin_inset CommandInset ref
LatexCommand prettyref
reference "fig:Place-details"

\end_inset

 shows the result of tapping one of the stars - the name of the place is
 
\begin_inset Quotes eld
\end_inset

Rose Alley
\begin_inset Quotes erd
\end_inset

, it has been visited 37 times and the last time this happened was in the
 early hours of July the 10th.
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Section
User Guide - Locale plugin
\end_layout

\begin_layout Standard
The 
\noun on
Context Analyser
\noun default
 plugin for 
\noun on
Locale
\noun default
 allows you to create 
\noun on
Locale
\noun default
 situations based on information provided by the 
\noun on
Context Analyser
\noun default
.
 
\noun on
Locale
\noun default
 is an application which allows you to make your phone change settings,
 send tweets, or perform a variety of other actions, whenever a certain
 'situation' occurs.
 A situation is just a set of conditions - such as your location, your phone's
 battery life, or the current time.
 The 
\noun on
Context Analyser
\noun default
 application automatically determines your current activity (such as 'walking'
 or 'sitting down'), and your predicted destination if you're travelling.
 This plugin requires that you have both 
\noun on
Context Analyser
\noun default
 and 
\noun on
Locale
\noun default
 installed.
 Both are available from the Android market.
\end_layout

\begin_layout Standard
The plugin adds two new conditions which you can use in 
\noun on
Locale
\noun default
 situations:
\end_layout

\begin_layout Itemize
Activity - the activity you are 
\emph on
most likely
\emph default
 performing
\end_layout

\begin_layout Itemize
Destination - your 
\emph on
most likely
\emph default
 destination, if you're not at a known location
\end_layout

\begin_layout Standard
A basic overview of adding these new conditions follows.
 For full documentation on how to use 
\noun on
Locale
\noun default
, consult the 
\noun on
Locale 
\noun default
user manual.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename locale-situations.png

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Locale main screen
\begin_inset CommandInset label
LatexCommand label
name "fig:Locale-main-screen"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset

When you open 
\noun on
Locale
\noun default
, you will see a list of currently defined situations (
\begin_inset CommandInset ref
LatexCommand prettyref
reference "fig:Locale-main-screen"

\end_inset

).
 You can edit existing situations by tapping on them.
 Existing situations may be deleted by clicking on the red minus button
 to the right of the situation name.
 Finally, new situations can be created by tapping the 'Add Situation' button
 at the bottom of the screen.
 
\noun on
Locale 
\noun default
shows any situations that are 
\emph on
active
\emph default
 (all the conditions currently hold true) in bold.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename locale-situation-pre.png

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Locale editing situation
\begin_inset CommandInset label
LatexCommand label
name "fig:Locale-editing-situation"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename locale-add-condition.png

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Locale add condition popup
\begin_inset CommandInset label
LatexCommand label
name "fig:Locale-add-condition"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset

Once you've selected a situation to edit, or created a brand new situation,
 you will see 
\noun on
Locale
\noun default
's 'edit situation' screen (
\begin_inset CommandInset ref
LatexCommand prettyref
reference "fig:Locale-editing-situation"

\end_inset

).
 This allows you to set the name of the situation, add or edit conditions,
 and add or edit settings.
 The 
\noun on
Context Analyser
\noun default
 plugin adds two new conditions, which are shown in the list when you click
 'Add condition' (
\begin_inset CommandInset ref
LatexCommand prettyref
reference "fig:Locale-add-condition"

\end_inset

).
 Select either 'Activity' or 'Destination' to add a new condition based
 on your current context.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename locale-select-destination.png

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Locale plugin selecting destination
\begin_inset CommandInset label
LatexCommand label
name "fig:Locale-plugin-selecting"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename locale-select-activity.png

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Locale plugin selecting activity
\begin_inset CommandInset label
LatexCommand label
name "fig:Locale-plugin-selecting-activity"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset

When you select one of the plugin's conditions, you will be presented with
 a screen which allows you to specify which activity (see 
\begin_inset CommandInset ref
LatexCommand prettyref
reference "fig:Locale-plugin-selecting-activity"

\end_inset

) or destination (see 
\begin_inset CommandInset ref
LatexCommand prettyref
reference "fig:Locale-plugin-selecting"

\end_inset

) you wish to match.
 For activities, you can select one of sitting, standing, walking, walking
 up stairs, walking down stairs, dancing, travelling bar car, or travelling
 by bus.
 For destination, you may select any place which the 
\noun on
Context Analyser
\noun default
 has previously detected.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename locale-menu.png

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Locale condition editor menu
\begin_inset CommandInset label
LatexCommand label
name "fig:Locale-condition-editor"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset

Once you've selected your chosen activity or destination, press the 
\noun on
menu
\noun default
 button and select the 'Save Changes' option (see 
\begin_inset CommandInset ref
LatexCommand prettyref
reference "fig:Locale-condition-editor"

\end_inset

).
 You will then return to the situation editor where the new condition will
 be displayed.
 You may then add settings as with any other 
\noun on
Locale
\noun default
 situation, and 
\noun on
Locale
\noun default
 will automatically apply these when all of the conditions match.
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Section
User Guide - Context Home Screen
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Section
Developer Guide
\end_layout

\begin_layout Standard
This guide details how you can integrate the data made available by the
 
\noun on
Context Analyser
\noun default
 into your own applications.
 It is expected that you are familiar with Android application development
 and general concepts.
 For an overview of how the 
\noun on
Context Analyser 
\noun default
works, please consult the user guide.
\end_layout

\begin_layout Standard
The 
\noun on
Context Analyser
\noun default
 exposes its data via a set of Content Providers.
 These are augmented by several broadcast intents which can be used by third
 party applications to receive immediate notification when the user's context
 changes.
 
\end_layout

\begin_layout Subsection
Permissions
\begin_inset CommandInset label
LatexCommand label
name "sub:Permissions"

\end_inset


\end_layout

\begin_layout Standard
In order to protect the user's privacy, a series of permissions are defined
 by the 
\noun on
Context Analyser
\noun default
, and access to data and broadcast intents is limited to applications which
 hold the appropriate permissions.
 The 
\noun on
Context Analyser
\noun default
 defines the following permissions:
\end_layout

\begin_layout Itemize
uk.co.md87.android.contextanalyser.RECEIVE_UPDATES - allows the application to
 receive real-time updates about context or place information through broadcast
 intents
\end_layout

\begin_layout Itemize
uk.co.md87.android.contextanalyser.READ_PLACES - allows the application to read
 places from the relevant content provider
\end_layout

\begin_layout Itemize
uk.co.md87.android.contextanalyser.WRITE_PLACES - allows the application to modify
 places via the relevant content provider
\end_layout

\begin_layout Itemize
uk.co.md87.android.contextanalyser.READ_JOURNEYS - allows the application to
 read journey information from the relevant content providers
\end_layout

\begin_layout Itemize
uk.co.md87.android.contextanalyser.WRITE_JOURNEYS - allows the application to
 modify journey information via the relevant content providers
\end_layout

\begin_layout Itemize
uk.co.md87.android.contextanalyser.BROADCAST - permission used when broadcasting
 context-related intents.
 Applications may wish to check that broadcasters hold this permission to
 prevent third parties broadcasting erroneous data.
\end_layout

\begin_layout Standard
If you do not declare the required permissions, a run time error will occur
 when your application attempts to access protected data.
 All permissions listed here are defined as 
\noun on
dangerous
\noun default
, which means that end users will be prompted about them when installing
 any application using them; this is in line with the underlying accelerometer
 and location permissions.
\end_layout

\begin_layout Subsection
Model
\end_layout

\begin_layout Standard
The 
\noun on
Context Analyser
\noun default
 is backed by a database containing tables for 
\emph on
places
\emph default
, 
\emph on
journeys
\emph default
 and 
\emph on
journey steps
\emph default
.
 Activities and predictions are stored in memory.
\end_layout

\begin_layout Standard
A 
\series bold
place
\series default
 is a location represented by a latitude/longitude tuple.
 Places have a radius of 500 metres; whenever a user moves to within 500
 metres of a known place, they are assumed to be located at that place.
 New places are identified when the user is observed to be in the same location
 (within 500 metres) for three consecutive readings, which occur at 1 minute
 intervals.
 Places also have an associated name, which is initially set to a string
 representation of the latitude and longitude; the 
\noun on
Context Analyser
\noun default
 will attempt to rename any place with such a name by geocoding the latitude/lon
gitude into a nearby street or landmark name.
\end_layout

\begin_layout Standard
An 
\series bold
activity
\series default
 is represented by a string delimited by forward slashes (
\noun on
/
\noun default
).
 This forms a hierarchy of classifications, with the following possible
 values:
\end_layout

\begin_layout Itemize
CLASSIFIED/DANCING
\end_layout

\begin_layout Itemize
CLASSIFIED/IDLE/SITTING
\end_layout

\begin_layout Itemize
CLASSIFIED/IDLE/STANDING
\end_layout

\begin_layout Itemize
CLASSIFIED/VEHICLE/BUS
\end_layout

\begin_layout Itemize
CLASSIFIED/VEHICLE/CAR
\end_layout

\begin_layout Itemize
CLASSIFIED/WALKING
\end_layout

\begin_layout Itemize
CLASSIFIED/WALKING/STAIRS/DOWN
\end_layout

\begin_layout Itemize
CLASSIFIED/WALKING/STAIRS/UP
\end_layout

\begin_layout Standard
It is possible for activities to contain only a part of the hierarchy -
 for example if the readings alternate between classifications for travelling
 by bus and by car, they will be aggregated and the resulting activity will
 be simply CLASSIFIED/VEHICLE
\noun on
.

\noun default
 Similarly, if the user's activity is in constant flux, the resulting activity
 will be aggregated to simply 'CLASSIFIED'.
\end_layout

\begin_layout Standard
A 
\series bold
journey
\series default
 is a recorded sequence of activites which occured when the user moved from
 one place to another.
 Whenever the user leaves a known place, the 
\noun on
Context Analyser
\noun default
 begins a log of activities; when they then reach another known place, the
 log is converted into a journey.
 Each journey consists of a sequence of 
\series bold
journey steps
\series default
, which describe a single activity and a number of reptitions.
\end_layout

\begin_layout Standard
For example, if the user leaves place A, spends five minutes walking, then
 ten minutes on a bus, and arrives at place B:
\end_layout

\begin_layout Itemize
A journey will be created with a start point of A and an end point of B
\end_layout

\begin_layout Itemize
The journey will consist of two journey steps:
\end_layout

\begin_deeper
\begin_layout Itemize
Step one will have an activity of CLASSIFIED/WALKING with five reptitions
\end_layout

\begin_layout Itemize
Step two will have an activity of CLASSIFIED/VEHICLE/BUS with ten reptitions
\end_layout

\end_deeper
\begin_layout Standard
When the user is on a journey, the Context Analyser compares their current
 history to that of previously recorded journeys leaving the same place.
 If any of the journeys match, their destinations are considered as 
\series bold
predictions
\series default
.
 The number of times each matching journey occured is summed and the result
 is used as a 'score' for the destination involved.
 The destination with the highest score is considered the most likely destinatio
n for the user.
\end_layout

\begin_layout Standard
For the purposes of prediction, a partial journey is considered to match
 a historical journey if:
\end_layout

\begin_layout Itemize
it contains the same number of, or fewer, steps
\end_layout

\begin_layout Itemize
each step has the same activity
\end_layout

\begin_layout Itemize
the number of reptitions in each completed step (not the last step) is:
\end_layout

\begin_deeper
\begin_layout Itemize
no less than 50% of the historical value
\end_layout

\begin_layout Itemize
no greater than 150% of the historical value
\end_layout

\end_deeper
\begin_layout Itemize
the number of repititions of the last step is:
\end_layout

\begin_deeper
\begin_layout Itemize
no greater than 150% of the historical value
\end_layout

\end_deeper
\begin_layout Subsection
Broadcast intents
\end_layout

\begin_layout Standard
The 
\noun on
Context Analyser
\noun default
 broadcasts three different intents to make other applications aware of
 certain events.
 Applications require the RECEIVE_UPDATES permission to receive these broadcasts
, as discussed previously.
 These intents are:
\end_layout

\begin_layout Itemize
uk.co.md87.android.contextanalyser.ACTIVITY_CHANGED
\end_layout

\begin_layout Itemize
uk.co.md87.android.contextanalyser.CONTEXT_CHANGED
\end_layout

\begin_layout Itemize
uk.co.md87.android.contextanalyser.PREDICTION_AVAILABLE
\end_layout

\begin_layout Standard
The 
\series bold
ACTIVITY_CHANGED
\series default
 intent is broadcast whenever the user's activity is discovered to have
 changed.
 It contains two string extras - the old activity and the new activity -
 under the keys 
\begin_inset Quotes eld
\end_inset

old
\begin_inset Quotes erd
\end_inset

 and 
\begin_inset Quotes eld
\end_inset

new
\begin_inset Quotes erd
\end_inset

 respectively.
\end_layout

\begin_layout Standard
The 
\series bold
CONTEXT_CHANGED
\series default
 intent occurs whenever some other aspect of the user's context changes.
 Presently this only includes the user's current place.
 It contains an integer extra under the key 
\begin_inset Quotes eld
\end_inset

type
\begin_inset Quotes erd
\end_inset

 which describes which type of context has changed; this will have the value
 1 for place updates.
 Place updates will also have two further integer extras - the place the
 user was previously in (or -1 if they were not in a known place) and the
 place the user is now in - under the keys 
\begin_inset Quotes eld
\end_inset

old
\begin_inset Quotes erd
\end_inset

 and 
\begin_inset Quotes eld
\end_inset

new
\begin_inset Quotes erd
\end_inset

, respectively.
 These place IDs can be resolved to names and latitude/longitude by querying
 the relevant content provider, described below.
\end_layout

\begin_layout Standard
The 
\series bold
PREDICTION_AVAILABLE
\series default
 intent is broadcast whenever a prediction has been made by the 
\noun on
Context Analyser
\noun default
.
 The best available prediction is included as a place ID in the 
\begin_inset Quotes eld
\end_inset

best_target
\begin_inset Quotes erd
\end_inset

 key, the total score for the prediction to that place is available as an
 integer in the 
\begin_inset Quotes eld
\end_inset

count
\begin_inset Quotes erd
\end_inset

 key, and the 'probability' (the score for that place divided by the total
 scores for all predicted places) is a float in the 
\begin_inset Quotes eld
\end_inset

best_probability
\begin_inset Quotes erd
\end_inset

 key.
 A full set of predictions can be retrieved from the relevant content provider,
 described below.
\end_layout

\begin_layout Standard
As discussed in the permissions section (
\begin_inset CommandInset ref
LatexCommand prettyref
reference "sub:Permissions"

\end_inset

), you may wish to make sure that all broadcasts you receive are sent by
 an application which holds the BROADCAST permission.
 This ensures that the user trusts the application to send these broadcasts,
 and reduces the chance that they are from a malicious application attempting
 to introduce erroneous data or otherwise compromise your receiver.
\end_layout

\begin_layout Subsection
Content providers
\end_layout

\begin_layout Standard
The 
\noun on
Context Analyser
\noun default
 provides four content providers from which you can receive data:
\end_layout

\begin_layout Subsubsection
Activities
\end_layout

\begin_layout Standard
Allows querying of the user's current activity.
 This may be expanded in future versions to allow querying of all known
 activities.
 Read only, does not accept selection, projection or order parameters.
\end_layout

\begin_layout Standard
URI: 
\noun on
content://uk.co.md87.android.contextanalyser.activitiescontentprovider/current
\end_layout

\begin_layout Standard
Content type: 
\noun on
vnd.contextanalyser.activity
\end_layout

\begin_layout Standard
Columns:
\end_layout

\begin_layout Standard
\begin_inset Tabular
<lyxtabular version="3" rows="2" columns="3">
<features>
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Name
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Type
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Remarks
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
activity
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
string
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
The user's current activity
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Subsubsection
Journeys
\end_layout

\begin_layout Standard
Allows querying of the user's historical journeys and steps within them.
 Read/write access, supports selection and ordering.
\end_layout

\begin_layout Paragraph
Journeys
\end_layout

\begin_layout Standard
URI: 
\noun on
content://uk.co.md87.android.contextanalyser.journeyscontentprovider/journeys
\end_layout

\begin_layout Standard
Content type: 
\noun on
vnd.contextanalyser.journey
\end_layout

\begin_layout Standard
Columns:
\end_layout

\begin_layout Standard
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="3">
<features>
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Name
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Type
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Remarks
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
_id
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
long
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
A unique, persistent ID for the journey
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
start
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
long
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
The ID of the place at which this journey starts
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
end
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
long
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
The ID of the place at which this journey ends
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
steps
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
int
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
The number of steps in this journey
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
number
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
int
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
The number of times this journey has been made
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Paragraph
Journey steps
\end_layout

\begin_layout Standard
URI: 
\noun on
content://uk.co.md87.android.contextanalyser.journeyscontentprovider/steps
\end_layout

\begin_layout Standard
Content type: 
\noun on
vnd.contextanalyser.journeystep
\end_layout

\begin_layout Standard
Columns:
\end_layout

\begin_layout Standard
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="3">
<features>
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Name
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Type
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Remarks
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
_id
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
long
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
A unique, persistent ID for the step
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
activity
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
string
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
The activity that was observed
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
repetitions
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
int
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
The number of times the activity occured
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
journey
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
long
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
The ID of the journey that this step belongs to
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
next
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
long
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
The ID of the next step in the journey, or 0 if the last step in sequence
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Subsubsection
Places
\end_layout

\begin_layout Standard
Allows querying of the user's know places.
 Read/write access, supports selection and ordering.
\end_layout

\begin_layout Standard
URI: 
\noun on
content://uk.co.md87.android.contextanalyser.placescontentprovider/places
\end_layout

\begin_layout Standard
Content type: 
\noun on
vnd.contextanalyser.location
\end_layout

\begin_layout Standard
Columns:
\end_layout

\begin_layout Standard
\begin_inset Tabular
<lyxtabular version="3" rows="8" columns="3">
<features>
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Name
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Type
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Remarks
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
_id
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
long
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
A unique, persistent ID for the place
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
name
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
string
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
The name of the place
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
latitude
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
double
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
The latitude of the centre of the place
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
longitude
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
double
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
The longitude at the centre of the place
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
duration
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
long
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Amount of time in seconds spent at the place
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
times
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
long
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
The number of times the place has been visited
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
lastvisit
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
long
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
The unix timestamp of the last visit (seconds)
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Subsubsection
Predictions
\end_layout

\begin_layout Standard
Allows querying of the current predictions, if any.
 Read only, does not accept selection, projection or order parameters.
\end_layout

\begin_layout Standard
URI: 
\noun on
content://uk.co.md87.android.contextanalyser.predictionscontentprovider/predictions
\end_layout

\begin_layout Standard
Content type: 
\noun on
vnd.contextanalyser.prediction
\end_layout

\begin_layout Standard
Columns:
\end_layout

\begin_layout Standard
\begin_inset Tabular
<lyxtabular version="3" rows="4" columns="3">
<features>
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Name
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Type
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Remarks
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
_ID
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
long
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
A unique ID for the prediction
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
place
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
long
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
The ID of the predicted destination
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
count
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
int
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
The 'score' of the prediction
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Subsection
Context API
\end_layout

\begin_layout Standard
A small 
\begin_inset Quotes eld
\end_inset

API
\begin_inset Quotes erd
\end_inset

 is available to facilitate easier access to the services exposed by the
 
\noun on
Context Analyser.

\noun default
 This consists of the 
\noun on
ContextApi
\noun default
 class and its assorted subclasses.
 These subclasses contain constant values for all column names, URIs and
 content types, as well as intent names and enumeration values.
\end_layout

\begin_layout Standard
The 
\noun on
ContextApi.Intents
\noun default
 class defines string constants for the three broadcast intents which are
 used by the 
\noun on
Context Analyser
\noun default
.
 The 
\noun on
ContextTypes
\noun default
 inner class contains integer constants for the possible 'type' values for
 the CONTEXT_CHANGED intent.
\end_layout

\begin_layout Standard
The 
\noun on
Places
\noun default
, 
\noun on
Journeys
\noun default
, 
\noun on
JourneySteps
\noun default
, 
\noun on
Predictions 
\noun default
and 
\noun on
Activities
\noun default
 classes all contain a CONTENT_URI field containing the Uri of the the content
 provider, a CONTENT_TYPE field containing the string mime type for that
 provider, and a static 
\noun on
ColumnNames
\noun default
 class which contains string constants for each column returned by the content
 provider.
\end_layout

\begin_layout Standard
The following code from the 
\noun on
Places
\noun default
 application shows the use of these constant values:
\end_layout

\begin_layout LyX-Code
final Cursor cursor = managedQuery(ContextApi.Places.CONTENT_URI,
\end_layout

\begin_layout LyX-Code
         new String[] { ColumnNames.LATITUDE, ColumnNames.LONGITUDE,     
                 
\end_layout

\begin_layout LyX-Code
         ColumnNames._ID, ColumnNames.NAME, ColumnNames.LAST_VISIT,       
           
\end_layout

\begin_layout LyX-Code
         ColumnNames.VISIT_COUNT }, null, null, null);
\end_layout

\begin_layout LyX-Code

\end_layout

\begin_layout LyX-Code
if (cursor.moveToFirst()) { 
\end_layout

\begin_layout LyX-Code
    final int nameColumn = cursor.getColumnIndex(ColumnNames.NAME);
\end_layout

\begin_layout LyX-Code
    final int idColumn = cursor.getColumnIndex(ColumnNames._ID);
\end_layout

\begin_layout LyX-Code

\end_layout

\begin_layout LyX-Code
    do {
\end_layout

\begin_layout LyX-Code
        final String name = cursor.getString(nameColumn);
\end_layout

\begin_layout LyX-Code
        final int id = cursor.getInt(idColumn);
\end_layout

\begin_layout LyX-Code
        // etc
\end_layout

\begin_layout LyX-Code
    } while (cursor.moveToNext());
\end_layout

\begin_layout LyX-Code
}
\end_layout

\begin_layout Standard
Note that the code imports both the 
\noun on
ContextApi
\noun default
 class, and the 
\noun on
ContextApi.Places.ColumnNames
\noun default
 class.
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\begin_inset CommandInset bibtex
LatexCommand bibtex
bibfiles "/home/chris/Projects/Java/ContextApi/papers/project"
options "bibtotoc,savetrees"

\end_inset


\end_layout

\end_body
\end_document
